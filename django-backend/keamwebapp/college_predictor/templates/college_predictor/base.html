{% load static %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Predict the college you're likely to get an admission in using your KEAM rank">
    <!-- CSS, Fonts & Favicon only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cabin&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@500&display=swap" rel="stylesheet">
    <!-- <link rel="icon" type="image/png" sizes="16x16" href="https://cdn.discordapp.com/attachments/817763487546736640/879375954349285376/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="192x192" href="https://cdn.discordapp.com/attachments/817763487546736640/879375954114408448/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="https://cdn.discordapp.com/attachments/817763487546736640/879375954475089950/android-chrome-512x512.png"> -->
    <title>Allotment Predictor</title>
    <style>
      html, body {
    max-width: 100%;
    /* overflow-x: auto; */
    }
        .r1{
  font-weight: bold;
  background: white;
  /*width:75vw;*/
  margin: 2em auto; 
  line-height: 40px;
}
.r2{
  font-weight: bold;
  background:white;
  width:75vw;
  margin: 2em auto;
}
button{
  width: 100px;
  margin: auto 0;
}
button:hover{
  background-color: black;
  color: white;
}

.btn-container {   
  height: 50px;  
  position: relative;
}
.center {  
  margin: 0;  
  position: absolute;  
  left: 50%;
  -ms-transform: translate(-50%, 30%);  
  transform: translate(-50%, 30%);
}

h2 {
  height: 20px;
  width: fit-content;
  margin: 1.5em auto;
  font-weight: 800;
}

h6 {
  height: auto;
  width: calc(100% - 3em);
  margin: 1.5em auto;
  font-family: 'Source Sans Pro', sans-serif;
  font-size: 1.21em;
}

footer {
  background-color: black;
  color: white;
  font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
  position: relative;
  /* flex-shrink: 0; */
  bottom: 0px;
  width: 100%;
  padding: 0px 10px;
}

table {
  margin-top: 2em;
}

th:nth-child(1),th:nth-child(2),th:nth-child(3), h6{
  text-align: center;
}

.font-nav {
  font-family: 'Source Sans Pro', sans-serif;
  font-size: 2em;
}

html, body { 
  height: 100vh;
}

body { 
  display: grid;
}

.asteriskField {
  content-visibility: hidden;
}
table div > .container > .r1 > .table{
  /*background-color: #FFF4A1;*/
  border: 1px solid grey;
}

thead > tr:nth-child(1) {
  background-color: #AEB1B1;
}
tr > td:nth-child(5){
  display:none
}
tr > th:nth-child(5){
  display:none
}

ul.legend { 
  list-style: none; 
  border: 1px solid black;
  height: 50px;
  width: 100%;
  background-color: #aeb1b1;
  border-radius: 6px;
  display: flex;
  justify-content: space-evenly;
  margin-top:2em;
  padding-left:0px;
}

.legend li { 
  float: left; 
  margin-right: 20px; 
}

.legend span { 
  border: 0px solid #ccc; 
  float: left; 
  width: 20px;
  height: 20px; 
  margin: 10px; }

.legend .lesslikely { 
  background-color: #ffb654; 
}
.legend .likely { 
  background-color: #fff4a1; 
}
.legend .morelikely { 
  background-color: #a9ea74; 
}

svg{
  width: 3em;
  height: 3em;
}
a {
  text-decoration: none;
}
a.pdf-svg{
  color: red;
}

@media screen and (max-width: 768){
  .table{
    line-height: 1.5em;
  }
}

@media screen and (max-width:460px){
  ul.legend{
    display:grid;
    grid-template-columns:1fr;
    height:8em;
  }
  ul.legend>li{
    margin-left:4em;
  }
  ul.legend>li>span{
    margin-right:4em;
  }
}
</style>
</head>
<body>
    <header>
        <nav class="navbar navbar-dark bg-dark text-center">
            <div class="container-fluid">
              <div class="navbar-header font-change">
                <a class="navbar-brand font-nav" href="#">Keam Allotment Predictor
                    2021</a>
              </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <h2>
            Predict your KEAM allotment
        </h2>
        <div>
            <h6>
                *KEAM Allotment Predictor 2021 is to help KEAM 2021 Students and parents for the selection of suitable engineering colleges in Kerala based on KEAM entrance rank.  The working of Rank Predictor is based on the statistical information (last year third round allotment) of KEAM 2020. KEAM College predictor is made simple and innovative as possible. Students and parents can save searching time about courses and colleges using this web page. The last rank given as  is based on the state admission quota - which is 50% of the intake in private colleges.  Decisions for option allotment and admission can be done easily with this tool.
            </h6>
            <div class="text-center">
                <a class="pdf-svg" href="https://drive.google.com/file/d/1Lg3rT3qENzhnQ7xDOHSy2DbO6HwKJrR7/view?usp=sharing" target="_blank">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
                    <path style="fill:#E2E5E7;" d="M128,0c-17.6,0-32,14.4-32,32v448c0,17.6,14.4,32,32,32h320c17.6,0,32-14.4,32-32V128L352,0H128z"/>
                    <path style="fill:#B0B7BD;" d="M384,128h96L352,0v96C352,113.6,366.4,128,384,128z"/>
                    <polygon style="fill:#CAD1D8;" points="480,224 384,128 480,128 "/>
                    <path style="fill:#F15642;" d="M416,416c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V256c0-8.8,7.2-16,16-16h352c8.8,0,16,7.2,16,16
                      V416z"/>
                    <g>
                      <path style="fill:#FFFFFF;" d="M101.744,303.152c0-4.224,3.328-8.832,8.688-8.832h29.552c16.64,0,31.616,11.136,31.616,32.48
                        c0,20.224-14.976,31.488-31.616,31.488h-21.36v16.896c0,5.632-3.584,8.816-8.192,8.816c-4.224,0-8.688-3.184-8.688-8.816V303.152z
                         M118.624,310.432v31.872h21.36c8.576,0,15.36-7.568,15.36-15.504c0-8.944-6.784-16.368-15.36-16.368H118.624z"/>
                      <path style="fill:#FFFFFF;" d="M196.656,384c-4.224,0-8.832-2.304-8.832-7.92v-72.672c0-4.592,4.608-7.936,8.832-7.936h29.296
                        c58.464,0,57.184,88.528,1.152,88.528H196.656z M204.72,311.088V368.4h21.232c34.544,0,36.08-57.312,0-57.312H204.72z"/>
                      <path style="fill:#FFFFFF;" d="M303.872,312.112v20.336h32.624c4.608,0,9.216,4.608,9.216,9.072c0,4.224-4.608,7.68-9.216,7.68
                        h-32.624v26.864c0,4.48-3.184,7.92-7.664,7.92c-5.632,0-9.072-3.44-9.072-7.92v-72.672c0-4.592,3.456-7.936,9.072-7.936h44.912
                        c5.632,0,8.96,3.344,8.96,7.936c0,4.096-3.328,8.704-8.96,8.704h-37.248V312.112z"/>
                    </g>
                    <path style="fill:#CAD1D8;" d="M400,432H96v16h304c8.8,0,16-7.2,16-16v-16C416,424.8,408.8,432,400,432z"/>
                  </svg>
                  <div>More Info</div>
                </a>
            </div>
        </div>
    </div>
    <div class="container r1">
        <form method="POST" class="container-fluid">
            {% csrf_token %}
            {{ form|crispy }}
            <div class="btn-container">
                <div class="center">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </div>
        </form>
        {% if df_html %}
            <ul class="legend">
              <li><span class="lesslikely"></span> Less likely</li>
              <li><span class="likely"></span> Likely</li>
              <li><span class="morelikely"></span> More likely</li>
            </ul>
        {{ df_html | safe }}
        {% endif %}
        
    </div>
    <footer>
        <span>
            Designed and Intended for public service.
        </span>
    </footer>
    <!-- JavaScript Bundle with Popper -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', (event) => {
            count = 0;
            $("tbody > tr ").each(function(){
                let href  = $(this).find("td:nth-child(5)").html();
                if( href != "NaN"){
                    let aTag =  $(document.createElement('a'));
                    let innerhtml = $(this).find("td:nth-child(3)").html();

                    aTag.attr('href',href);
                    aTag.html(innerhtml);
                    aTag.attr("target","blank");
                    $(this).find("td:nth-child(3)").html(aTag);
                }

                let rank = parseInt($("#id_rank").val());  
                let rank_in_tr = parseInt($(this).find("td:nth-child(4)").html());
                if(rank_in_tr < rank){
                    $(this).css("background-color", "orange");
                    $(this).css("border", "1px solid grey");
                    count++;
                }
                else if(rank_in_tr < rank*2 || count< 2){
                    $(this).css("background-color", "#FFF4A1");
                    $(this).css("border", "1px solid grey");
                    count++;
                }
                else{
                    $(this).css("background-color", "#A9EA74");
                    $(this).css("border", "1px solid grey");
                }
            });
        });
    </script>
</body>
</html>
